name: Java CI with Gradle (1.20.1 Forge)

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    
    steps:
    - uses: actions/checkout@v4
    
    # 1.20.1 推荐使用 Java 17 进行编译（与 build.gradle 的 toolchain 保持一致）
    # 但由于 Gradle 8.10+ 支持运行在 Java 21 上，这里用 17 或 21 均可。
    # 为了稳妥，建议保持 17，Gradle 会自动处理兼容性。
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'

    - name: List files
      run: ls -la
        
    # 【关键修改】移除强制的 '8.3'，改用 '8.10.2' 或让其自动读取 wrapper 配置
    - name: Setup Gradle
      uses: gradle/actions/setup-gradle@v3
      with:
        gradle-version: '8.10.2'  # 与本地 gradle-wrapper.properties 保持一致
        cache-disabled: true  #cache-disabled: true  #
      
    # 【建议修改】进入 forge 目录并使用 wrapper 构建，确保环境绝对一致
    # 原先的 'gradle build' 使用的是全局命令，容易产生版本歧义
    - name: Build with Gradle
      run: |
        cd forge
        chmod +x gradlew
        ./gradlew build
      
    - name: Upload Build Artifact
      uses: actions/upload-artifact@v4
      with:
        name: My-Forge-Mod-1.20.1
        path: forge/build/libs/*.jar # 注意路径变化，构建产物在 forge 子目录下
        retention-days: 5
